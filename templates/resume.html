<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reanudar Proceso de Creación de Video</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; color: #1c1e21; margin: 0; padding: 2rem; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { max-width: 800px; width: 100%; margin: auto; background: #fff; padding: 2rem 2.5rem; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
        h1 { color: #1c1e21; text-align: center; margin-bottom: 1.5rem; font-size: 2rem; }
        .status-grid { display: grid; grid-template-columns: auto 1fr auto; gap: 1rem 1.5rem; align-items: center; margin-bottom: 2rem; border-top: 1px solid #ddd; padding-top: 1.5rem; }
        .status-icon { font-size: 1.5rem; }
        .status-label { font-weight: 600; font-size: 1.1rem; }
        .status-count { font-style: italic; color: #606770; font-size: 0.9rem; }
        .message { padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; text-align: center; font-weight: 500; }
        .message.info { background-color: #e7f3ff; color: #1877f2; border: 1px solid #bde0ff; }
        .message.success { background-color: #e9f7ef; color: #31a24c; border: 1px solid #c3e6cb; }
        .message.error { background-color: #fede; color: #f02849; border: 1px solid #f5c6cb; }
        button { background-color: #1877f2; color: white; padding: 0.8rem 1.5rem; border: none; border-radius: 6px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: background-color 0.3s; width: 100%; }
        button:hover { background-color: #166fe5; }
        button:disabled { background-color: #ccd0d5; color: #8d949e; cursor: not-allowed; }
        .form-options { margin-bottom: 1.5rem; display: flex; gap: 1.5rem; justify-content: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Estado del Proceso</h1>

        {% if status.published.count > 0 %}
            <div class="message success">¡Completado! El video ha sido generado y publicado.</div>
        {% elif status.final_video.exists and status.metadata.count > 0 %}
            <div class="message info">Listo para subir a YouTube.</div>
        {% elif status.final_video.exists %}
            <div class="message info">Listo para generar metadatos.</div>
        {% elif status.lyrics.count > 0 and status.songs.count > 0 and status.clips.count > 0 %}
            <div class="message info">Listo para ensamblar el video.</div>
        {% elif status.lyrics.count > 0 and status.songs.count > 0 %}
            <div class="message error">Acción Requerida: No se encontraron clips de video en la carpeta 'clips'. Por favor, añade archivos de video (.mp4, .mov) para poder continuar.</div>
        {% elif status.lyrics.count > 0 %}
            <div class="message info">Listo para crear canciones.</div>
        {% else %}
            <div class="message error">No hay suficiente progreso para reanudar. Inicia un nuevo proceso.</div>
        {% endif %}

        <div class="status-grid">
            <div class="status-icon">{{ '✅' if status.lyrics.count > 0 else '❌' }}</div>
            <div class="status-label">1. Letras Generadas</div>
            <div class="status-count">({{ status.lyrics.count }} archivos .txt)</div>

            <div class="status-icon">{{ '✅' if status.songs.count > 0 else '❌' }}</div>
            <div class="status-label">2. Canciones Creadas</div>
            <div class="status-count">({{ status.songs.count }} archivos .mp3)</div>

            <div class="status-icon">{{ '✅' if status.clips.count > 0 else '❌' }}</div>
            <div class="status-label">3. Clips de Video Disponibles</div>
            <div class="status-count">({{ status.clips.count }} archivos de video)</div>

            <div class="status-icon">{{ '✅' if status.final_video.exists else '❌' }}</div>
            <div class="status-label">4. Video Final Ensamblado</div>
            <div class="status-count">({{ 'final_video.mp4' if status.final_video.exists else 'No generado' }})</div>

            <div class="status-icon">{{ '✅' if status.metadata.count > 0 else '❌' }}</div>
            <div class="status-label">5. Metadatos para YouTube</div>
            <div class="status-count">({{ status.metadata.count }} archivos .txt)</div>

            <div class="status-icon">{{ '✅' if status.published.count > 0 else '❌' }}</div>
            <div class="status-label">6. Publicado en YouTube</div>
            <div class="status-count">({{ status.published.count }} informes)</div>
        </div>

        <form action="/resume" method="POST">
            <div class="form-options">
                <div>
                    <label for="suno_model">Modelo de Suno:</label>
                    <select name="suno_model" id="suno_model">
                        <option value="chirp-auk-turbo" selected>Standard (v2 - chirp-auk-turbo)</option>
                        <option value="chirp-crow">Premium (v3 - chirp-crow)</option>
                    </select>
                </div>
                <div>
                    <input type="checkbox" name="instrumental" id="instrumental">
                    <label for="instrumental">Es Instrumental</label>
                </div>
                <div>
                    <input type="checkbox" name="subtitles" id="subtitles" checked>
                    <label for="subtitles">Añadir Subtítulos</label>
                </div>
            </div>
            <button type="submit" {{ 'disabled' if status.published.count > 0 or (status.clips.count == 0 and status.lyrics.count > 0) }}>
                {{ 'Proceso Completado' if status.published.count > 0 else 'Reanudar Proceso' }}
            </button>
        </form>
    </div>
</body>
</html>